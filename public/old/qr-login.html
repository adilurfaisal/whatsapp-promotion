<!DOCTYPE html>
<html>
<!--
    WARNING! Make sure that you match all Quasar related
    tags to the same version! (Below it's "@2.11.6")
  -->

<head>
    <link href="css/Material-Icons-Outlined.css" rel="stylesheet" type="text/css">
    <link href="css/quasar.prod.css" rel="stylesheet" type="text/css">
    <link href="css/style.css" rel="stylesheet" type="text/css">
</head>

<body>
    <!-- example of injection point where you write your app template -->
    <div id="q-app">

        <q-layout view="hhh lpR fff">

            <q-header elevated class="bg-primary text-white">
                <q-toolbar>
                    <q-btn dense flat round icon="menu" @click="leftDrawerOpen = !leftDrawerOpen"></q-btn>
                </q-toolbar>
            </q-header>

            <q-drawer show-if-above v-model="leftDrawerOpen" side="left" bordered>
                <q-scroll-area class="fit">
                    <q-list padding class="menu-list">
                        <q-item clickable v-ripple>
                            <q-item-section>
                                <a href="qr-login.html">QR Login</a>
                            </q-item-section>
                        </q-item>
                        <q-item clickable v-ripple>
                            <q-item-section>
                                <a href="index.html">Search</a>
                            </q-item-section>
                        </q-item>
                        <q-item clickable v-ripple>
                            <q-item-section>
                                <a href="template.html">Template</a>
                            </q-item-section>
                        </q-item>
                    </q-list>
                </q-scroll-area>
            </q-drawer>

            <q-page-container>

                <div class="q-pa-md">
                    <div style="height: 60vh;">
                        <q-img :src="qrcodeUrl" spinner-color="white" style="height: 400px; max-width: 400px;"></q-img>
                    </div>
                </div>

            </q-page-container>

        </q-layout>

    </div>

    <!-- Add the following at the end of your body tag -->
    <script src="js/vue.global.prod.js"></script>
    <script src="js/quasar.umd.prod.js"></script>
    <script src="js/axios.min.js"></script>

    <script>
        let { ipcRenderer } = require("electron")
        const QRCode = require('qrcode');

        const app = Vue.createApp({
            data() {
                return {
                    leftDrawerOpen: false,
                    qrcode: "",
                    qrcodeUrl: ``
                }
            },
            mounted() {
                ipcRenderer.on("ready", async (evt, data) => {
                    if(data==true){
                        window.location.href = "index.html";
                    }
                });

                ipcRenderer.on("qr-login", async (evt, data) => {
                    this.qrcode = data
                    QRCode.toDataURL(this.qrcode, {}, (err, url) => {
                        if (err) throw err;
                        this.qrcodeUrl = url;
                    })

                });
            },
            methods: {
                async qrRequest() {
                    const result = await ipcRenderer.invoke('qr-login', [])
                }
            }
        })

        app.use(Quasar)
        app.mount('#q-app')
    </script>
</body>

</html>